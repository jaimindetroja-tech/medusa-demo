# ğŸ”„ Data Flow Diagrams

## ğŸ“Š Complete End-to-End Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CRON TRIGGER                                    â”‚
â”‚                      Daily at 00:00 (Midnight)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    START: syncProductsJob()                             â”‚
â”‚                    Log: "ğŸš€ Starting product sync job..."               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PHASE 1: FETCH ALL PRODUCTS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  fetchAllProducts()                                                     â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€ Page 1: GET https://dummyjson.com/products?limit=30&skip=0         â”‚
â”‚  â”‚  â”œâ”€ fetchWithRetry() [Max 3 retries]                                â”‚
â”‚  â”‚  â””â”€ Response: { products: [...30 items], total: 194 }               â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€ Page 2: GET https://dummyjson.com/products?limit=30&skip=30        â”‚
â”‚  â”‚  â”œâ”€ fetchWithRetry() [Max 3 retries]                                â”‚
â”‚  â”‚  â””â”€ Response: { products: [...30 items], total: 194 }               â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€ Page 3: GET https://dummyjson.com/products?limit=30&skip=60        â”‚
â”‚  â”‚  â””â”€ ... continues until skip >= total                               â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â””â”€ Page 7: GET https://dummyjson.com/products?limit=30&skip=180       â”‚
â”‚     â””â”€ Response: { products: [...14 items], total: 194 }               â”‚
â”‚                                                                         â”‚
â”‚  Result: 194 products fetched                                           â”‚
â”‚  Log: "ğŸ‰ Successfully fetched 194 total products"                     â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 2: SYNC CATEGORIES (Bar Raiser)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Extract unique categories from 194 products:                           â”‚
â”‚  â€¢ beauty, fragrances, furniture, groceries, home-decoration,           â”‚
â”‚    kitchen-accessories, laptops, mens-shirts, mens-shoes,               â”‚
â”‚    mens-watches, mobile-accessories, motorcycle, skin-care,             â”‚
â”‚    smartphones, sports-accessories, sunglasses, tablets,                â”‚
â”‚    tops, vehicle, womens-bags, womens-dresses, womens-jewellery,        â”‚
â”‚    womens-shoes, womens-watches                                         â”‚
â”‚                                                                         â”‚
â”‚  Total: 24 unique categories                                            â”‚
â”‚                                                                         â”‚
â”‚  syncCategoriesWorkflow.run({ categories: [...] })                      â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€ Query existing categories from Medusa                               â”‚
â”‚  â”‚  query.graph({ entity: "product_category" })                         â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€ Build map: handle â†’ id                                              â”‚
â”‚  â”‚  { "beauty": "cat_01...", "fragrances": "cat_02...", ... }           â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€ Filter new categories (not in map)                                  â”‚
â”‚  â”‚  First run: All 24 are new                                           â”‚
â”‚  â”‚  Second run: 0 are new (idempotent!)                                 â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”œâ”€ Create new categories                                               â”‚
â”‚  â”‚  createProductCategoriesWorkflow.run({                               â”‚
â”‚  â”‚    product_categories: [                                             â”‚
â”‚  â”‚      { name: "Beauty", handle: "beauty", is_active: true },          â”‚
â”‚  â”‚      { name: "Fragrances", handle: "fragrances", is_active: true },  â”‚
â”‚  â”‚      ...                                                             â”‚
â”‚  â”‚    ]                                                                 â”‚
â”‚  â”‚  })                                                                  â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â””â”€ Return categoryMap: { slug â†’ id }                                   â”‚
â”‚                                                                         â”‚
â”‚  Result: { created: 24, existing: 0, categoryMap: {...} }               â”‚
â”‚  Log: "âœ… Categories synced: 24 created, 0 existing"                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PHASE 3: CHECK EXISTING PRODUCTS (Idempotency)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Query Medusa database for existing products:                           â”‚
â”‚  query.graph({                                                          â”‚
â”‚    entity: "product",                                                   â”‚
â”‚    fields: ["id", "handle", "metadata"]                                 â”‚
â”‚  })                                                                     â”‚
â”‚                                                                         â”‚
â”‚  First run: 0 products                                                  â”‚
â”‚  Second run: 194 products                                               â”‚
â”‚                                                                         â”‚
â”‚  Build maps:                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ existingProductMap: Map<external_id, product>           â”‚            â”‚
â”‚  â”‚ {                                                       â”‚            â”‚
â”‚  â”‚   "1" â†’ { id: "prod_01...", handle: "iphone-9", ... }  â”‚            â”‚
â”‚  â”‚   "2" â†’ { id: "prod_02...", handle: "iphone-x", ... }  â”‚            â”‚
â”‚  â”‚   ...                                                   â”‚            â”‚
â”‚  â”‚ }                                                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ dbHandles: Set<string>                                  â”‚            â”‚
â”‚  â”‚ { "iphone-9", "iphone-x", "samsung-universe-9", ... }   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                         â”‚
â”‚  Log: "ğŸ“Š Found 0 existing products in Medusa" (first run)             â”‚
â”‚       "ğŸ“Š Found 194 existing products in Medusa" (second run)          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        PHASE 4: TRANSFORM & CATEGORIZE PRODUCTS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  For each of 194 products:                                              â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Product #1: { id: 1, title: "iPhone 9", ... }               â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚  1. Transform to Medusa format:                               â”‚     â”‚
â”‚  â”‚     mapToMedusaFormat(product)                                â”‚     â”‚
â”‚  â”‚     â†’ { title: "iPhone 9", handle: "iphone-9", ... }          â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚  2. Check if exists:                                          â”‚     â”‚
â”‚  â”‚     existing = existingProductMap.get("1")                    â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚  3a. IF EXISTS (Second run):                                  â”‚     â”‚
â”‚  â”‚      â€¢ Keep existing handle: "iphone-9"                       â”‚     â”‚
â”‚  â”‚      â€¢ Add to UPDATE list:                                    â”‚     â”‚
â”‚  â”‚        productsToUpdate.push({                                â”‚     â”‚
â”‚  â”‚          id: "prod_01...",                                    â”‚     â”‚
â”‚  â”‚          data: { title, description, metadata, ... }          â”‚     â”‚
â”‚  â”‚        })                                                     â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚  3b. IF NEW (First run):                                      â”‚     â”‚
â”‚  â”‚      â€¢ Ensure unique handle:                                  â”‚     â”‚
â”‚  â”‚        - Check usedHandles and dbHandles                      â”‚     â”‚
â”‚  â”‚        - If collision: append counter                         â”‚     â”‚
â”‚  â”‚          "iphone-9" â†’ "iphone-9-1" â†’ "iphone-9-2"             â”‚     â”‚
â”‚  â”‚      â€¢ Link to category:                                      â”‚     â”‚
â”‚  â”‚        category_ids = [categoryMap["smartphones"]]            â”‚     â”‚
â”‚  â”‚      â€¢ Add to CREATE list:                                    â”‚     â”‚
â”‚  â”‚        productsToCreate.push(product)                         â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                         â”‚
â”‚  Result (First run):                                                    â”‚
â”‚  â€¢ productsToCreate: 194 items                                          â”‚
â”‚  â€¢ productsToUpdate: 0 items                                            â”‚
â”‚                                                                         â”‚
â”‚  Result (Second run):                                                   â”‚
â”‚  â€¢ productsToCreate: 0 items                                            â”‚
â”‚  â€¢ productsToUpdate: 194 items                                          â”‚
â”‚                                                                         â”‚
â”‚  Log: "ğŸ“ 194 products to create" (first run)                          â”‚
â”‚       "ğŸ”„ 0 products to update"                                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 5: BATCH PROCESSING - CREATE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  IF productsToCreate.length > 0:                                        â”‚
â”‚                                                                         â”‚
â”‚  for await (const batch of batchGenerator(productsToCreate, 15)) {      â”‚
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚  Batch 1: Products 1-15                                 â”‚         â”‚
â”‚    â”‚                                                         â”‚         â”‚
â”‚    â”‚  createProductsWorkflow(container).run({                â”‚         â”‚
â”‚    â”‚    input: { products: [                                 â”‚         â”‚
â”‚    â”‚      { title: "iPhone 9", handle: "iphone-9", ... },    â”‚         â”‚
â”‚    â”‚      { title: "iPhone X", handle: "iphone-x", ... },    â”‚         â”‚
â”‚    â”‚      ... (15 products)                                  â”‚         â”‚
â”‚    â”‚    ]}                                                   â”‚         â”‚
â”‚    â”‚  })                                                     â”‚         â”‚
â”‚    â”‚                                                         â”‚         â”‚
â”‚    â”‚  âœ… Success: createdCount += 15                         â”‚         â”‚
â”‚    â”‚  Log: "âœ… Batch 1: Created 15 products (15/194)"       â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚  Batch 2: Products 16-30                                â”‚         â”‚
â”‚    â”‚  ... (same process)                                     â”‚         â”‚
â”‚    â”‚  Log: "âœ… Batch 2: Created 15 products (30/194)"       â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â”‚    ... continues for 13 batches total ...                               â”‚
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚  Batch 13: Products 181-194 (14 products)               â”‚         â”‚
â”‚    â”‚  ... (same process)                                     â”‚         â”‚
â”‚    â”‚  Log: "âœ… Batch 13: Created 14 products (194/194)"     â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â”‚  Result: createdCount = 194                                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PHASE 6: BATCH PROCESSING - UPDATE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  IF productsToUpdate.length > 0:                                        â”‚
â”‚                                                                         â”‚
â”‚  for await (const batch of batchGenerator(productsToUpdate, 15)) {      â”‚
â”‚                                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚  Batch 1: Products 1-15                                 â”‚         â”‚
â”‚    â”‚                                                         â”‚         â”‚
â”‚    â”‚  updateProductsWorkflow(container).run({                â”‚         â”‚
â”‚    â”‚    input: { products: [                                 â”‚         â”‚
â”‚    â”‚      {                                                  â”‚         â”‚
â”‚    â”‚        id: "prod_01...",                                â”‚         â”‚
â”‚    â”‚        data: { title: "...", description: "...", ... }  â”‚         â”‚
â”‚    â”‚      },                                                 â”‚         â”‚
â”‚    â”‚      ... (15 products)                                  â”‚         â”‚
â”‚    â”‚    ]}                                                   â”‚         â”‚
â”‚    â”‚  })                                                     â”‚         â”‚
â”‚    â”‚                                                         â”‚         â”‚
â”‚    â”‚  âœ… Success: updatedCount += 15                         â”‚         â”‚
â”‚    â”‚  Log: "âœ… Batch 1: Updated 15 products (15/194)"       â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                         â”‚
â”‚    ... continues for all batches ...                                    â”‚
â”‚  }                                                                      â”‚
â”‚                                                                         â”‚
â”‚  Result: updatedCount = 194 (on second run)                             â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 7: FINAL SUMMARY                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Calculate duration:                                                    â”‚
â”‚  duration = (Date.now() - startTime) / 1000                             â”‚
â”‚                                                                         â”‚
â”‚  Log Summary:                                                           â”‚
â”‚  ============================================================            â”‚
â”‚  ğŸ‰ Product sync completed!                                            â”‚
â”‚  ============================================================            â”‚
â”‚  âœ… Created: 194                                                        â”‚
â”‚  ğŸ”„ Updated: 0                                                          â”‚
â”‚  âŒ Errors: 0                                                           â”‚
â”‚  â±ï¸  Duration: 12.34s                                                  â”‚
â”‚  ============================================================            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Retry Flow (Detailed)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        fetchWithRetry("https://dummyjson.com/...")         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Attempt 1 (Initial)                                        â”‚
â”‚  â”œâ”€ fetch(url)                                              â”‚
â”‚  â”‚                                                          â”‚
â”‚  â”œâ”€ SUCCESS? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   â””â”€ Return data                          â”‚              â”‚
â”‚  â”‚                                            â”‚              â”‚
â”‚  â””â”€ FAILURE? (Network error, 500, timeout)   â”‚              â”‚
â”‚      â”‚                                        â”‚              â”‚
â”‚      â”œâ”€ Log: "âš ï¸  Attempt 1/4 failed"        â”‚              â”‚
â”‚      â”œâ”€ Calculate delay: 1000ms              â”‚              â”‚
â”‚      â””â”€ Wait 1000ms                          â”‚              â”‚
â”‚                                              â”‚              â”‚
â”‚  Attempt 2                                   â”‚              â”‚
â”‚  â”œâ”€ fetch(url)                               â”‚              â”‚
â”‚  â”‚                                           â”‚              â”‚
â”‚  â”œâ”€ SUCCESS? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚
â”‚  â”‚   â””â”€ Return data                       â”‚  â”‚              â”‚
â”‚  â”‚                                         â”‚  â”‚              â”‚
â”‚  â””â”€ FAILURE?                               â”‚  â”‚              â”‚
â”‚      â”‚                                     â”‚  â”‚              â”‚
â”‚      â”œâ”€ Log: "âš ï¸  Attempt 2/4 failed"     â”‚  â”‚              â”‚
â”‚      â”œâ”€ Calculate delay: 2000ms           â”‚  â”‚              â”‚
â”‚      â””â”€ Wait 2000ms                       â”‚  â”‚              â”‚
â”‚                                            â”‚  â”‚              â”‚
â”‚  Attempt 3                                 â”‚  â”‚              â”‚
â”‚  â”œâ”€ fetch(url)                             â”‚  â”‚              â”‚
â”‚  â”‚                                         â”‚  â”‚              â”‚
â”‚  â”œâ”€ SUCCESS? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚              â”‚
â”‚  â”‚   â””â”€ Return data                     â”‚  â”‚  â”‚              â”‚
â”‚  â”‚                                       â”‚  â”‚  â”‚              â”‚
â”‚  â””â”€ FAILURE?                             â”‚  â”‚  â”‚              â”‚
â”‚      â”‚                                   â”‚  â”‚  â”‚              â”‚
â”‚      â”œâ”€ Log: "âš ï¸  Attempt 3/4 failed"   â”‚  â”‚  â”‚              â”‚
â”‚      â”œâ”€ Calculate delay: 4000ms         â”‚  â”‚  â”‚              â”‚
â”‚      â””â”€ Wait 4000ms                     â”‚  â”‚  â”‚              â”‚
â”‚                                          â”‚  â”‚  â”‚              â”‚
â”‚  Attempt 4 (Final)                       â”‚  â”‚  â”‚              â”‚
â”‚  â”œâ”€ fetch(url)                           â”‚  â”‚  â”‚              â”‚
â”‚  â”‚                                       â”‚  â”‚  â”‚              â”‚
â”‚  â”œâ”€ SUCCESS? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚              â”‚
â”‚  â”‚   â””â”€ Return data                   â”‚  â”‚  â”‚  â”‚              â”‚
â”‚  â”‚                                     â”‚  â”‚  â”‚  â”‚              â”‚
â”‚  â””â”€ FAILURE?                           â”‚  â”‚  â”‚  â”‚              â”‚
â”‚      â””â”€ Throw Error                    â”‚  â”‚  â”‚  â”‚              â”‚
â”‚         "Failed after 4 attempts"      â”‚  â”‚  â”‚  â”‚              â”‚
â”‚                                        â”‚  â”‚  â”‚  â”‚              â”‚
â”‚                                        â–¼  â–¼  â–¼  â–¼              â”‚
â”‚                                   Return Data                 â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Batch Processing Flow

```
Input: 194 products
Batch Size: 15

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           batchGenerator(products, 15)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Memory State:                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Heap: ~50MB (only 15 products in memory at a time) â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Iteration 1:                                               â”‚
â”‚  â”œâ”€ Slice: products[0:15]                                   â”‚
â”‚  â”œâ”€ Yield: [Product 1, Product 2, ..., Product 15]          â”‚
â”‚  â””â”€ Process batch â†’ createProductsWorkflow()                â”‚
â”‚      â””â”€ Memory freed after processing                       â”‚
â”‚                                                             â”‚
â”‚  Iteration 2:                                               â”‚
â”‚  â”œâ”€ Slice: products[15:30]                                  â”‚
â”‚  â”œâ”€ Yield: [Product 16, Product 17, ..., Product 30]        â”‚
â”‚  â””â”€ Process batch â†’ createProductsWorkflow()                â”‚
â”‚      â””â”€ Memory freed after processing                       â”‚
â”‚                                                             â”‚
â”‚  ... continues ...                                          â”‚
â”‚                                                             â”‚
â”‚  Iteration 13:                                              â”‚
â”‚  â”œâ”€ Slice: products[180:194]                                â”‚
â”‚  â”œâ”€ Yield: [Product 181, Product 182, ..., Product 194]     â”‚
â”‚  â””â”€ Process batch â†’ createProductsWorkflow()                â”‚
â”‚      â””â”€ Memory freed after processing                       â”‚
â”‚                                                             â”‚
â”‚  Done                                                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

VS. Without Batching:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Process all 194 products at once                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Heap: ~650MB (all products in memory)              â”‚   â”‚
â”‚  â”‚ Risk: Out of memory errors                         â”‚   â”‚
â”‚  â”‚ Risk: Slow processing                              â”‚   â”‚
â”‚  â”‚ Risk: If one fails, all fail                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ­ Idempotency Flow (First vs Second Run)

### First Run (No existing products)

```
External Products: 194
Existing Products: 0

For each product:
  existing = existingProductMap.get(external_id)
  â†’ undefined (not found)
  
  â†’ Add to CREATE list
  
Result:
  productsToCreate: 194
  productsToUpdate: 0
  
Action:
  Create 194 products in Medusa
```

### Second Run (All products exist)

```
External Products: 194
Existing Products: 194

For each product:
  existing = existingProductMap.get(external_id)
  â†’ { id: "prod_01...", handle: "iphone-9", ... } (found!)
  
  â†’ Add to UPDATE list
  
Result:
  productsToCreate: 0
  productsToUpdate: 194
  
Action:
  Update 194 products in Medusa
  (No duplicates created!)
```

---

## ğŸ”— Category Linking Flow

```
Product: { id: 1, title: "iPhone 9", category: "smartphones" }

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Category Linking Process                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Get category name from product:                         â”‚
â”‚     category = "smartphones"                                â”‚
â”‚                                                             â”‚
â”‚  2. Generate category slug:                                 â”‚
â”‚     slug = "smartphones"                                    â”‚
â”‚            .toLowerCase()                                   â”‚
â”‚            .replace(/[^a-z0-9]+/g, "-")                     â”‚
â”‚     â†’ "smartphones"                                         â”‚
â”‚                                                             â”‚
â”‚  3. Look up category ID in map:                             â”‚
â”‚     categoryMap = {                                         â”‚
â”‚       "smartphones": "cat_01JGXXX...",                      â”‚
â”‚       "laptops": "cat_01JGYYY...",                          â”‚
â”‚       ...                                                   â”‚
â”‚     }                                                       â”‚
â”‚     categoryId = categoryMap["smartphones"]                 â”‚
â”‚     â†’ "cat_01JGXXX..."                                      â”‚
â”‚                                                             â”‚
â”‚  4. Add to product:                                         â”‚
â”‚     product.category_ids = ["cat_01JGXXX..."]               â”‚
â”‚                                                             â”‚
â”‚  5. When product is created:                                â”‚
â”‚     Medusa automatically creates the link:                  â”‚
â”‚     product_category_product table:                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     â”‚ product_id   â”‚ category_id     â”‚                     â”‚
â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
â”‚     â”‚ prod_01...   â”‚ cat_01JGXXX...  â”‚                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš¨ Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Error Handling Strategy                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Level 1: Network Errors (fetchWithRetry)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Try â†’ Fail â†’ Retry â†’ Fail â†’ Retry â†’ Fail â†’ Throw  â”‚   â”‚
â”‚  â”‚  Handles: Timeouts, 500 errors, network issues     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Level 2: Category Sync Errors                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  try {                                              â”‚   â”‚
â”‚  â”‚    syncCategoriesWorkflow()                         â”‚   â”‚
â”‚  â”‚  } catch (error) {                                  â”‚   â”‚
â”‚  â”‚    Log warning                                      â”‚   â”‚
â”‚  â”‚    Continue with product sync                       â”‚   â”‚
â”‚  â”‚    (Products won't have categories, but will sync)  â”‚   â”‚
â”‚  â”‚  }                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Level 3: Batch Processing Errors                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  for each batch {                                   â”‚   â”‚
â”‚  â”‚    try {                                            â”‚   â”‚
â”‚  â”‚      createProductsWorkflow(batch)                  â”‚   â”‚
â”‚  â”‚    } catch (error) {                                â”‚   â”‚
â”‚  â”‚      Log error                                      â”‚   â”‚
â”‚  â”‚      errorCount += batch.length                     â”‚   â”‚
â”‚  â”‚      Continue with next batch                       â”‚   â”‚
â”‚  â”‚      (One batch fails, others continue)             â”‚   â”‚
â”‚  â”‚    }                                                â”‚   â”‚
â”‚  â”‚  }                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  Level 4: Job-Level Errors                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  try {                                              â”‚   â”‚
â”‚  â”‚    // Entire sync process                          â”‚   â”‚
â”‚  â”‚  } catch (error) {                                  â”‚   â”‚
â”‚  â”‚    Log: "ğŸ’¥ Product sync failed"                   â”‚   â”‚
â”‚  â”‚    throw error (job marked as failed)              â”‚   â”‚
â”‚  â”‚  }                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Next**: [04-implementation.md](./04-implementation.md) - Step-by-step implementation guide
